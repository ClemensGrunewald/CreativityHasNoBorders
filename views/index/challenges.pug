extends ../layout.pug
include ../modules/mixins_index.pug


mixin current_challenge(name, title, active_until, desc, short_mode, brief)
  div.content_wrapper
    h4(class="red_text") Current challenge
    h2.title #{title}
    p.timeframe ACTIVE UNTIL: #{prettyDate(active_until)}
    p #{desc}

    if(short_mode.enabled)
      p Warning! Timer starts running once you progress.
      p Countdown:
      h2.countdown(class="red_text") #{toCountdown(short_mode.countdown)}
    a(href=brief target="_blank")
      div.button(class="blue_bg") Download current Brief
    a(href="/u/"+data.user.username+"/new?challenge="+name)
      div.button(class="red_bg") Upload your solution

mixin past_challenge(title, active_until, desc, short_mode)
  div.content_wrapper
    h4(class="red_text") Past challenge
    h2.title #{title}
    p.timeframe ACTIVE UNTIL: #{prettyDate(active_until)}
    p #{desc}

    if(short_mode.enabled)
      p This Challenge was time restricted.
      h2.countdown(class="red_text") #{toCountdown(short_mode.countdown)}

  div.button_icon(class="green_bg blue_text") Winners

  div#portfolio_list(class="list")
    ul.list_wrapper
      a(href="#")
        li
          div.image(style="background-image:url('images/index.png')")
          div.content
            h4 SUSI SUNSHINE
            p > View Portfolio
      a(href="#")
        li
          div.image(style="background-image:url('images/index.png')")
          div.content
            h4 PENNY PENNROSE
            p > View Portfolio
      a(href="#")
        li
          div.image(style="background-image:url('images/index.png')")
          div.content
            h4 SIR_CLEE
            p > View Portfolio




//- Stylesheets exclusive for this subpage
block styles
  link(rel='stylesheet', href='/styles/helpers.css')
  link(rel='stylesheet', href='/styles/index_challenges.css')

//- Stylesheets exclusive for this subpage
block scripts

//- Main content to extend the Layout template
block content

  //- LOGO MODULE
  +logoModule

  //- CURRENT CHALLENGE
  div#current_challenge(class="main_wrapper")
    div.top_gradient_box(class="green_gradient")
      h1(class="blue_text")= data.modules[0].title.substring(0, data.modules[0].title.indexOf(" "))
      h1(class="blue_text")= data.modules[0].title.substring(data.modules[0].title.indexOf(" ")+1, data.modules[0].title.length)
      span.pink_subline

    each challenge in data.current_challenges
      +current_challenge(challenge.name, challenge.title, challenge.active_until, challenge.description, challenge.shortMode, challenge.brief )



  //- DECORATIONAL ELEMENT
  div(style="position:relative; width:100%; height:200px; background:black;")

  //- PREVIOUS CHALLENGES
  div#past_challenges(class="main_wrapper")
    +past_challenge(data.past_challenge.title, data.past_challenge.active_until, data.past_challenge.description, data.past_challenge.shortMode )


  //- HAND IN YOUR CHALLENGE
  div#your_brief(class="diagonal_box")
    svg(class="diagonal_shape" viewBox="0 0 100 10" preserveAspectRatio="none")
      path(d="M 0,0 L 100,0 100,4 0,10 z" style="fill: white;")
    div.inner_wrapper
      h1 Send us your Brief
      p We are always open to fresh ideas. Even if it comes to ideas for ideas. If you have a challenge that is worth being challenged, just write us an email.
      a(href="mailto:partner@creativityhasnoborders.com")
        div.button(class="blue_bg") PARTNER@CHNB.COM










  //- FUNCTIONS
  -function prettyDate(dateString){
    //if it's already a date object and not a string you don't need this line:
    -var date = new Date(dateString);
    -var d = date.getDate();
    -var monthNames = [ "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec" ];
    -var m = monthNames[date.getMonth()];
    -var y = date.getFullYear();
    -return d+' '+m+' '+y;
  -}

  -function toCountdown(s) {
    -s = s*60;
    -var fm = [Math.floor(s / 60 / 60 / 24),Math.floor(s / 60 / 60) % 24, Math.floor(s / 60) % 60, s % 60];
    -fm.forEach(function(part, index){
      -if(fm[index]<10) fm[index] = fm[index].toLocaleString('en-US', {minimumIntegerDigits: 2, useGrouping:false})
    -})
    -return fm.join(':');
  -}
